import { createUmi } from "@metaplex-foundation/umi-bundle-defaults";
import { mplCore, updateCollection } from "@metaplex-foundation/mpl-core";
import {
  createSignerFromKeypair,
  signerIdentity,
  Keypair,
  publicKey,
} from "@metaplex-foundation/umi";
import fs from "fs";

function loadKeypair(): Keypair {
  const secret = JSON.parse(fs.readFileSync("./src/user_wallet.json", "utf-8"));
  const secretKey = Uint8Array.from(secret);
  const umi = createUmi("https://api.devnet.solana.com");
  return umi.eddsa.createKeypairFromSecretKey(secretKey);
}

(async () => {
  const umi = createUmi("https://api.devnet.solana.com").use(mplCore());

  const wallet = loadKeypair();
  const signer = createSignerFromKeypair(umi, wallet);
  umi.use(signerIdentity(signer));

  // ðŸŸ¢ Your collection mint address (use your real one)
  const collectionMint = publicKey(
    "72v5mtrFkZXxdURUTTme4XZACRsk5sBk9eGuXBBnrh2P"
  );

  // ðŸŸ¡ Your 4 NFT mint addresses
  const nftMints = [
    "4YGPRgavtt4cwNeYz2rt1ff4M375DF8fQcoemqDvsNZ8", // Goku
    "8oozpKk77zUxHi9oxT1bX7UUVvjzAkt6irKaGcALyXi2", // Gohan
    "FDMLzigbtdHVmGWw6yPS8NFJgg2xPqxjRgmjjSRYXFLm", // Gotenks
    "C1GAz7CyuGF5vkZCdjrzjR5tVgTUSi5BEBDQX8eHuuWV", // Vegeta
  ];

  for (const nftMint of nftMints) {
    console.log(`Adding ${nftMint} to collection...`);
    await updateCollection(umi, {
      asset: publicKey(nftMint),
      collection: collectionMint,
    }).sendAndConfirm(umi);
    console.log(`âœ… Added ${nftMint}`);
  }

  console.log("âœ… All NFTs added to collection!");
  console.log(
    `View collection: https://core.metaplex.com/explorer/collection/${collectionMint}?env=devnet`
  );
})();
